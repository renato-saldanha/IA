# üì¶ API de Produtos

API RESTful para gerenciamento de produtos desenvolvida em Node.js com Express, seguindo padr√µes de arquitetura limpa e boas pr√°ticas de desenvolvimento.

## üìã √çndice

- [Vis√£o Geral](#vis√£o-geral)
- [Arquitetura](#arquitetura)
- [Tecnologias](#tecnologias)
- [Estrutura do Projeto](#estrutura-do-projeto)
- [Instala√ß√£o](#instala√ß√£o)
- [Configura√ß√£o](#configura√ß√£o)
- [Documenta√ß√£o da API](#documenta√ß√£o-da-api)
- [Modelo de Dados](#modelo-de-dados)
- [Valida√ß√µes](#valida√ß√µes)
- [Tratamento de Erros](#tratamento-de-erros)
- [Exemplos de Uso](#exemplos-de-uso)
- [Desenvolvimento](#desenvolvimento)
- [Pr√≥ximos Passos](#pr√≥ximos-passos)

---

## üéØ Vis√£o Geral

Esta API fornece endpoints RESTful completos para opera√ß√µes CRUD (Create, Read, Update, Delete) de produtos. O projeto foi desenvolvido seguindo o padr√£o **Repository Pattern + Service Layer**, garantindo separa√ß√£o de responsabilidades, manutenibilidade e testabilidade.

### Caracter√≠sticas Principais

- ‚úÖ Arquitetura em camadas (Repository, Service, Controller)
- ‚úÖ Valida√ß√£o de dados de entrada com `express-validator`
- ‚úÖ Persist√™ncia de dados em arquivo JSON (pronto para migra√ß√£o para banco de dados)
- ‚úÖ Tratamento centralizado de erros
- ‚úÖ C√≥digo documentado e organizado
- ‚úÖ Gera√ß√£o autom√°tica de IDs √∫nicos (UUID v4)

---

## üèóÔ∏è Arquitetura

O projeto segue uma arquitetura em camadas que separa as responsabilidades:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         Routes Layer                ‚îÇ  ‚Üê Define rotas e valida√ß√µes
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ       Controller Layer              ‚îÇ  ‚Üê Processa requisi√ß√µes/respostas
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ        Service Layer                ‚îÇ  ‚Üê L√≥gica de neg√≥cio
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ      Repository Layer               ‚îÇ  ‚Üê Acesso a dados
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ         Data Layer                  ‚îÇ  ‚Üê Persist√™ncia (JSON)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Camadas

1. **Routes**: Define as rotas HTTP e aplica valida√ß√µes de entrada
2. **Controller**: Recebe requisi√ß√µes, valida dados e formata respostas
3. **Service**: Cont√©m a l√≥gica de neg√≥cio (regras, valida√ß√µes de neg√≥cio)
4. **Repository**: Abstrai o acesso aos dados (leitura/escrita)
5. **Data**: Camada de persist√™ncia (atualmente arquivo JSON)

---

## üõ†Ô∏è Tecnologias

### Depend√™ncias Principais

- **Node.js** v16+ (testado em v24)
- **Express** ^5.1.0 - Framework web para Node.js
- **express-validator** ^7.3.1 - Valida√ß√£o de dados de entrada
- **uuid** ^13.0.0 - Gera√ß√£o de identificadores √∫nicos

### Depend√™ncias de Desenvolvimento

- **nodemon** ^3.1.11 - Monitoramento autom√°tico de altera√ß√µes durante desenvolvimento

---

## üìÅ Estrutura do Projeto

```
api-produtos/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ index.js                    # Ponto de entrada da aplica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ app.js                      # Configura√ß√£o do Express e middlewares
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ productsRoutes.js       # Rotas de produtos
‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ productController.js    # Controllers de produtos
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ productService.js       # L√≥gica de neg√≥cio
‚îÇ   ‚îú‚îÄ‚îÄ repositories/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ productRepository.js    # Acesso a dados
‚îÇ   ‚îî‚îÄ‚îÄ scripts/
‚îÇ       ‚îî‚îÄ‚îÄ testRepository.js       # Scripts de teste (opcional)
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îî‚îÄ‚îÄ products.json               # Armazenamento de dados (JSON)
‚îú‚îÄ‚îÄ package.json                    # Depend√™ncias e scripts
‚îî‚îÄ‚îÄ README.md                       # Documenta√ß√£o
```

---

## üöÄ Instala√ß√£o

### Pr√©-requisitos

- Node.js v16 ou superior
- npm (geralmente inclu√≠do com Node.js)
- Git (opcional, para clonar o reposit√≥rio)

### Passos de Instala√ß√£o

1. **Clone o reposit√≥rio** (ou navegue at√© a pasta do projeto):
 
2. **Instale as depend√™ncias**:
   ```bash
   npm install
   ```

3. **Verifique se o arquivo de dados existe**:
   - Certifique-se de que `data/products.json` existe
   - Se n√£o existir, crie o arquivo com conte√∫do: `[]`

4. **Inicie o servidor**:
   ```bash
   npm start
   # ou para desenvolvimento com auto-reload:
   npm run dev
   ```

5. **Verifique se est√° funcionando**:
   - Acesse: `http://localhost:3000/`
   - Voc√™ deve ver: `"API de produtos rodando!"`

---

## ‚öôÔ∏è Configura√ß√£o

### Vari√°veis de Ambiente

O projeto suporta as seguintes vari√°veis de ambiente:

| Vari√°vel | Descri√ß√£o | Padr√£o | Obrigat√≥rio |
|----------|-----------|--------|-------------|
| `PORT` | Porta em que o servidor ir√° rodar | `3000` | N√£o |

### Exemplo de Configura√ß√£o

Crie um arquivo `.env` na raiz do projeto (opcional):

```env
PORT=3000
```

---

## üìö Documenta√ß√£o da API

### Base URL

```
http://localhost:3000
```

### Endpoints

#### 1. Listar Todos os Produtos

Retorna uma lista com todos os produtos cadastrados.

**Endpoint:** `GET /products`

**Resposta de Sucesso (200 OK):**
```json
[
  {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "name": "Camiseta",
    "price": 49.9,
    "stock": 10,
    "description": "Camiseta 100% algod√£o"
  },
  {
    "id": "660e8400-e29b-41d4-a716-446655440001",
    "name": "Cal√ßa Jeans",
    "price": 129.9,
    "stock": 5,
    "description": "Cal√ßa jeans masculina"
  }
]
```

---

#### 2. Obter Produto por ID

Retorna os detalhes de um produto espec√≠fico.

**Endpoint:** `GET /products/:id`

**Par√¢metros de URL:**
- `id` (string, obrigat√≥rio) - ID √∫nico do produto (UUID)

**Resposta de Sucesso (200 OK):**
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "name": "Camiseta",
  "price": 49.9,
  "stock": 10,
  "description": "Camiseta 100% algod√£o"
}
```

**Resposta de Erro (404 Not Found):**
```json
{
  "message": "Produto n√£o encontrado"
}
```

---

#### 3. Criar Novo Produto

Cria um novo produto no sistema.

**Endpoint:** `POST /products`

**Body (JSON):**
```json
{
  "name": "Camiseta",
  "price": 49.9,
  "stock": 10,
  "description": "Camiseta 100% algod√£o"
}
```

**Resposta de Sucesso (201 Created):**
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "name": "Camiseta",
  "price": 49.9,
  "stock": 10,
  "description": "Camiseta 100% algod√£o"
}
```

**Resposta de Erro (400 Bad Request):**
```json
{
  "message": "Dados inv√°lidos",
  "details": [
    {
      "msg": "name deve ter pelo menos 3 caracteres",
      "param": "name",
      "location": "body"
    }
  ]
}
```

**Resposta de Erro - Nome Duplicado (400 Bad Request):**
```json
{
  "message": "J√° existe um produto com esse nome"
}
```

---

#### 4. Atualizar Produto

Atualiza os dados de um produto existente.

**Endpoint:** `PUT /products/:id`

**Par√¢metros de URL:**
- `id` (string, obrigat√≥rio) - ID √∫nico do produto (UUID)

**Body (JSON):**
```json
{
  "name": "Camiseta Nova",
  "price": 59.9,
  "stock": 8,
  "description": "Camiseta atualizada"
}
```

**Resposta de Sucesso (200 OK):**
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "name": "Camiseta Nova",
  "price": 59.9,
  "stock": 8,
  "description": "Camiseta atualizada"
}
```

**Resposta de Erro (404 Not Found):**
```json
{
  "message": "Produto n√£o encontrado"
}
```

**Resposta de Erro - Nome Duplicado (400 Bad Request):**
```json
{
  "message": "Outro produto j√° usa esse nome"
}
```

---

#### 5. Remover Produto

Remove um produto do sistema.

**Endpoint:** `DELETE /products/:id`

**Par√¢metros de URL:**
- `id` (string, obrigat√≥rio) - ID √∫nico do produto (UUID)

**Resposta de Sucesso (204 No Content):**
```
(sem conte√∫do)
```

**Resposta de Erro (404 Not Found):**
```json
{
  "message": "Produto n√£o encontrado"
}
```

---

## üìä Modelo de Dados

### Produto (Product)

| Campo | Tipo | Obrigat√≥rio | Descri√ß√£o | Valida√ß√µes |
|-------|------|-------------|-----------|------------|
| `id` | string (UUID) | Auto-gerado | Identificador √∫nico do produto | Gerado automaticamente |
| `name` | string | Sim | Nome do produto | M√≠nimo 3 caracteres |
| `price` | number (float) | Sim | Pre√ßo do produto | Deve ser maior que 0 |
| `stock` | number (integer) | N√£o | Quantidade em estoque | Deve ser >= 0 (padr√£o: 0) |
| `description` | string | N√£o | Descri√ß√£o do produto | Texto livre |

### Exemplo de Objeto Produto

```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "name": "Camiseta B√°sica",
  "price": 49.9,
  "stock": 10,
  "description": "Camiseta 100% algod√£o, cores variadas"
}
```

---

## ‚úÖ Valida√ß√µes

### Valida√ß√µes de Entrada (express-validator)

#### Campo `name`
- ‚úÖ Obrigat√≥rio
- ‚úÖ Deve ser uma string
- ‚úÖ M√≠nimo de 3 caracteres

#### Campo `price`
- ‚úÖ Obrigat√≥rio
- ‚úÖ Deve ser um n√∫mero (float)
- ‚úÖ Deve ser maior que 0

#### Campo `stock`
- ‚ö†Ô∏è Opcional
- ‚úÖ Se fornecido, deve ser um n√∫mero inteiro
- ‚úÖ Deve ser >= 0

#### Campo `description`
- ‚ö†Ô∏è Opcional
- ‚úÖ Se fornecido, deve ser uma string

### Regras de Neg√≥cio

1. **Nome √önico**: N√£o √© permitido criar produtos com nomes duplicados (case-insensitive)
2. **Atualiza√ß√£o de Nome**: Ao atualizar, n√£o √© permitido usar um nome que j√° existe em outro produto

---

## ‚ö†Ô∏è Tratamento de Erros

A API utiliza um middleware centralizado de tratamento de erros que retorna respostas padronizadas.

### C√≥digos de Status HTTP

| C√≥digo | Descri√ß√£o | Quando Ocorre |
|--------|-----------|---------------|
| 200 | OK | Opera√ß√£o bem-sucedida (GET, PUT) |
| 201 | Created | Produto criado com sucesso |
| 204 | No Content | Produto removido com sucesso |
| 400 | Bad Request | Dados inv√°lidos ou regra de neg√≥cio violada |
| 404 | Not Found | Recurso n√£o encontrado |
| 500 | Internal Server Error | Erro interno do servidor |

### Formato de Resposta de Erro

```json
{
  "message": "Mensagem de erro descritiva",
  "details": [
    {
      "msg": "Detalhe espec√≠fico do erro",
      "param": "campo",
      "location": "body"
    }
  ]
}
```

### Exemplos de Erros

**Valida√ß√£o Falhou:**
```json
{
  "message": "Dados inv√°lidos",
  "details": [
    {
      "msg": "name deve ter pelo menos 3 caracteres",
      "param": "name",
      "location": "body"
    },
    {
      "msg": "price deve ser n√∫mero maior que 0",
      "param": "price",
      "location": "body"
    }
  ]
}
```

**Produto N√£o Encontrado:**
```json
{
  "message": "Produto n√£o encontrado"
}
```

**Nome Duplicado:**
```json
{
  "message": "J√° existe um produto com esse nome"
}
```

---

## üí° Exemplos de Uso

### Usando cURL

#### Listar todos os produtos
```bash
curl -X GET http://localhost:3000/products
```

#### Obter produto por ID
```bash
curl -X GET http://localhost:3000/products/550e8400-e29b-41d4-a716-446655440000
```

#### Criar novo produto
```bash
curl -X POST http://localhost:3000/products \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Camiseta",
    "price": 49.9,
    "stock": 10,
    "description": "Camiseta 100% algod√£o"
  }'
```

#### Atualizar produto
```bash
curl -X PUT http://localhost:3000/products/550e8400-e29b-41d4-a716-446655440000 \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Camiseta Nova",
    "price": 59.9,
    "stock": 8,
    "description": "Camiseta atualizada"
  }'
```

#### Remover produto
```bash
curl -X DELETE http://localhost:3000/products/550e8400-e29b-41d4-a716-446655440000
```

### Usando Insomnia/Postman

1. **Base URL**: `http://localhost:3000`
2. **Headers**: `Content-Type: application/json` (para POST e PUT)
3. **Body**: Use formato JSON para requisi√ß√µes POST e PUT

### Exemplo Completo de Fluxo

```bash
# 1. Criar um produto
POST http://localhost:3000/products
{
  "name": "Notebook",
  "price": 2999.99,
  "stock": 5,
  "description": "Notebook Dell Inspiron 15"
}

# Resposta: 201 Created com o produto criado (incluindo ID)

# 2. Listar todos os produtos
GET http://localhost:3000/products

# 3. Obter o produto criado
GET http://localhost:3000/products/{id-retornado}

# 4. Atualizar o produto
PUT http://localhost:3000/products/{id-retornado}
{
  "name": "Notebook Dell",
  "price": 2799.99,
  "stock": 3,
  "description": "Notebook Dell Inspiron 15 - Promo√ß√£o"
}

# 5. Remover o produto
DELETE http://localhost:3000/products/{id-retornado}
```

---

## üîß Desenvolvimento

### Scripts Dispon√≠veis

| Comando | Descri√ß√£o |
|---------|-----------|
| `npm start` | Inicia o servidor em modo produ√ß√£o |
| `npm run dev` | Inicia o servidor em modo desenvolvimento com auto-reload (nodemon) |

### Estrutura de C√≥digo

O c√≥digo est√° organizado seguindo o padr√£o Repository + Service Layer:

- **Repository**: Abstrai o acesso aos dados, permitindo f√°cil migra√ß√£o para banco de dados
- **Service**: Cont√©m toda a l√≥gica de neg√≥cio e valida√ß√µes espec√≠ficas
- **Controller**: Processa requisi√ß√µes HTTP e formata respostas
- **Routes**: Define endpoints e aplica valida√ß√µes de entrada

### Boas Pr√°ticas Implementadas

- ‚úÖ Separa√ß√£o de responsabilidades
- ‚úÖ Valida√ß√£o de dados de entrada
- ‚úÖ Tratamento centralizado de erros
- ‚úÖ C√≥digo documentado
- ‚úÖ IDs √∫nicos (UUID)
- ‚úÖ Valida√ß√µes de neg√≥cio

---

## üöß Pr√≥ximos Passos

### Melhorias Sugeridas

1. **Banco de Dados**
   - Migrar de arquivo JSON para banco de dados (PostgreSQL, MySQL, MongoDB)
   - Implementar migrations
   - Adicionar ORM ou query builder (TypeORM, Sequelize, Prisma, Knex)

2. **Seguran√ßa**
   - Implementar autentica√ß√£o (JWT)
   - Adicionar autoriza√ß√£o (RBAC)
   - Implementar rate limiting
   - Configurar CORS adequadamente
   - Adicionar valida√ß√£o de entrada mais robusta

3. **Testes**
   - Testes unit√°rios (Jest)
   - Testes de integra√ß√£o (Supertest)
   - Testes de carga
   - Cobertura de c√≥digo

4. **Documenta√ß√£o**
   - Swagger/OpenAPI
   - Postman Collection
   - Diagramas de arquitetura

5. **DevOps**
   - CI/CD pipeline
   - Docker e Docker Compose
   - Deploy automatizado
   - Monitoramento e logging

6. **Funcionalidades**
   - Pagina√ß√£o na listagem
   - Filtros e busca
   - Ordena√ß√£o
   - Soft delete
   - Hist√≥rico de altera√ß√µes
   - Upload de imagens

---

## üêõ Problemas Comuns

### Erro: "argument handler must be a function"

**Causa**: O arquivo de rotas n√£o est√° exportando um Router corretamente.

**Solu√ß√£o**: Verifique se `productsRoutes.js` termina com `module.exports = router;`

### Erro: Permiss√µes de escrita em `data/products.json`

**Causa**: Falta de permiss√µes de escrita no arquivo ou diret√≥rio.

**Solu√ß√£o**: 
- Verifique as permiss√µes do arquivo no Windows
- Certifique-se de que o diret√≥rio `data/` existe
- Execute o terminal como administrador se necess√°rio

### Erro: Porta j√° em uso

**Causa**: A porta 3000 j√° est√° sendo usada por outro processo.

**Solu√ß√£o**: 
- Altere a porta usando a vari√°vel de ambiente: `PORT=3001 npm start`
- Ou encerre o processo que est√° usando a porta 3000

---

## üìÑ Licen√ßa

Este projeto est√° sob a licen√ßa MIT. Veja o arquivo `LICENSE` para mais detalhes.

---

## üë§ Autor

**Renato Saldanha**

---

## üìù Hist√≥rico de Vers√µes

- **1.0.0** - Vers√£o inicial
  - Implementa√ß√£o completa do CRUD
  - Valida√ß√µes de entrada
  - Arquitetura Repository + Service Layer
  - Persist√™ncia em arquivo JSON

---

**Desenvolvido com ‚ù§Ô∏è usando Node.js e Express**


